# Cross Account Replication - HOL-107

### Description

This configuration demonstrates how S3 bucket replication can be done from source bucket to destination bucket in a different AWS account.

Here we deploy two stacks to different AWS account, `ReplicationSource` to the replication source account in `eu-west-1` and another `ReplicationDestination` to the replication destination account in `eu-west-2`.

### Operation

**Before deployment**

**Deployment**

Lint the templates

```bash
$ cfn-lint ReplicationDestination.yaml
$ cfn-lint ReplicationSource.yaml
```

1. Deploy the `ReplicationDestination` stack to `eu-west-2` in the destination account

```bash
$ aws cloudformation deploy --template-file ReplicationDestination.yaml --stack-name ReplicationDestination --parameter-overrides file://private-parameters.json --region eu-west-2 --profile sovadmin
```

<!-- --capabilities CAPABILITY_NAMED_IAM -->

2. Deploy the `ReplicationSource` stack to `eu-west-1` in the source account

```bash
$ aws cloudformation deploy --template-file ReplicationSource.yaml --stack-name ReplicationSource --parameter-overrides file://private-parameters.json --capabilities CAPABILITY_NAMED_IAM --region eu-west-1 --profile sovtechchucks
```

**After deployment**

**Testing**

1. Copy a file to the source bucket

```bash
$ aws s3 cp cloud.png
```

**Debug Errors**  
In the case of error during deployment

```bash
$ aws cloudformation describe-stack-events --stack-name ReplicationDestination > events.json
```

**Cleanup**
Empty the bucket

```bash
$ aws s3 rm s3://simple-bucket-02-06 --recursive
```

To delete the stack

```bash
$ aws cloudformation delete-stack --stack-name ReplicationSource --region eu-west-1 --profole sovtechchucks
$ aws cloudformation delete-stack --stack-name ReplicationDestination --region eu-west-2 --profole sovadmin
```
