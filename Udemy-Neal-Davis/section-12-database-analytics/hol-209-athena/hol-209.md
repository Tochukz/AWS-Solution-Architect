# Query S3 ALB Access Logs with Athena - HOL-209

### Description

The configuration sets up an Application Load Balancer with access logs to an s3 bucket.

We then use Athena to query the access logs in the S3 bucket.

### Operation

**Before deployment**

**Deployment**

Lint the template

```bash
$ cfn-lint Athena.yaml
```

Deploy the stack

```bash
$ aws cloudformation deploy --template-file Athena.yaml --stack-name Athena --parameter-overrides file://private-parameters.json
```

**After deployment**

Get the `LoadBalancerDnsName` from the stack output

```bash
$ aws cloudformation describe-stacks --stack-name Athena --query "Stacks[0].Outputs" --no-cli-pager
```

**Testing**

1. Use the `LoadBalancerDnsName` to visit the application
2. Confirm that the access log file (`/AWSLogs/123456789/ELBAccessLogTestFile`) was created in your logs bucket
3. **Cleanup**
   Empty the S3 bucket

```bash
$ aws s3 rm s3://alb-access-logs-14-05 --recursive
```

To delete the stack

```bash
$ aws cloudformation delete-stack --stack-name Athena
```
