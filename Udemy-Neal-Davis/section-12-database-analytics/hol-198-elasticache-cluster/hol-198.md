# Create ElastiCache Cluster - HOL-198

### Description

### Operation

**Before deployment**

**Deployment**

Lint the template

```bash
$ cfn-lint UnencryptedRds.yaml
```

Deploy the stack

```bash
$ aws cloudformation deploy --template-file ElastiCache.yaml --stack-name ElastiCache  --parameter-overrides file://private-parameters.json
```

**After deployment**

1. Get the `PrimaryEndPoint` and `PublicIp` from the stack output

```bash
$ aws cloudformation describe-stacks --stack-name ElastiCache --query "Stacks[0].Outputs"
```

2. Use the `PrimaryEndPoint` to update the _host_ endpoint in the Python script `run.py`.

3. SSH into the EC2 instance.
4. Install the dependencies if they were not installed properly by the UserData script

```bash
## PIP
curl -O https://bootstrap.pypa.io/get-pip.py
python3 get-pip.py --user
## Redis
pip install redis
```

4. Using another terminale, copy the Python script to the EC2 instance

```bash
$ scp -i dev-simple-key.pem run.py ec2-user@35.177.182.70:~/run.py
```

5. Run the Python script in the EC2 instance

```bash
$ python3 run.py
```

**Testing**

Run the Python script (`run.py`) to insert a key-value pair into the Redis server.

```bash
# First install redis
$ pip install redis
# Then run the script
$ python run.py
```

**Cleanup**

To delete the stack

```bash
$ aws cloudformation delete-stack --stack-name ElastiCache
```
